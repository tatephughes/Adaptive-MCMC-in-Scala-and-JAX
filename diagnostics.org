#+TITLE: diagnostics in R

The package ~coda~ has some tools for MCMC diagnosing;
#+begin_src R :session example :results none
library(coda)
#+end_src

We perform some diagnostics in R.

#+begin_src R :session example :results output :exports both
# These files should be generated by ./run.sh

readfiles <- function() {

  tryCatch(
  {
    r_sample_IC <<- as.matrix(read.table("./data/r_sample_basetest_IC.csv", sep=","))
    r_sample_MD <<- as.matrix(read.table("./data/r_sample_basetest_MD.csv", sep=","))
    scala_sample_IC <<- as.matrix(read.table("./data/scala_sample_basetest_IC.csv", sep=","))
    scala_sample_MD <<- as.matrix(read.table("./data/scala_sample_basetest_MD.csv", sep=","))
    jax_sample_IC <<- as.matrix(read.table("./data/jax_sample_basetest_IC.csv", sep=","))
    jax_sample_MD <<- as.matrix(read.table("./data/jax_sample_basetest_MD.csv", sep=","))
  },
  error = function(e) {
    message('An Error Occurred, try running run.sh')
    print(e)
  },
  warning = function(w) {
    message('A Warning Occurred, try running run.sh')
    print(w)
    return(NA)
  }
  )

}

readfiles()

# these should all come from the settings
thinrate <- 100
n <- 10000
burnin <- 0
d <- 0

r_MD_chain <- mcmc(r_sample_MD, thin=thinrate, start=0)
r_IC_chain <- mcmc(r_sample_IC, thin=thinrate, start=0)
scala_MD_chain <- mcmc(scala_sample_MD, thin=thinrate, start=0)
scala_IC_chain <- mcmc(scala_sample_IC, thin=thinrate, start=0)
jax_MD_chain <- mcmc(jax_sample_MD, thin=thinrate, start=0)
jax_IC_chain <- mcmc(jax_sample_IC, thin=thinrate, start=0)

print(paste("The R (MD) average effective sample size is", mean(effectiveSize(r_MD_chain))))
print(paste("The R (IC) average effective sample size is", mean(effectiveSize(r_IC_chain))))
print(paste("The Scala (MD) average effective sample size is", mean(effectiveSize(scala_MD_chain))))
print(paste("The Scala (IC) average effective sample size is", mean(effectiveSize(scala_IC_chain))))
print(paste("The JAX (MD) average effective sample size is", mean(effectiveSize(jax_MD_chain))))
print(paste("The JAX (IC) average effective sample size is", mean(effectiveSize(jax_IC_chain))))
#+end_src

#+RESULTS:
#+begin_example
A Warning Occurred, try running run.sh
<simpleWarning in file(file, "rt"): cannot open file './data/r_sample_basetest_IC.csv': No such file or directory>
[1] NA
Error: object 'r_sample_MD' not found
Error: object 'r_sample_IC' not found
Error: object 'scala_sample_MD' not found
Error: object 'scala_sample_IC' not found
Error: object 'jax_sample_MD' not found
Error: object 'jax_sample_IC' not found
Error: object 'r_MD_chain' not found
Error: object 'r_IC_chain' not found
Error: object 'scala_MD_chain' not found
Error: object 'scala_IC_chain' not found
Error: object 'jax_MD_chain' not found
Error: object 'jax_IC_chain' not found
#+end_example

